'use strict';

var gulp = global.gulp = global.gulp || require('gulp');
var common = global.config = global.config || require('../utils/common.js');
var runSequence = global.runSequence = global.runSequence || require('run-sequence');

/** 
 * pre-push hook gulp tasks
 */
gulp.task('pre-push', function (done) {
    runSequence('scripts', 'coverage', 'spell-check-ci', 'api-diff', done);
});

/** 
 * pre-commit hook gulp tasks
 */
gulp.task('pre-commit', ['lint']);

/** 
 * commit-msg hook gulp tasks
 */
gulp.task('commit-msg', ['commit-message']);

/** 
 * ci-compile gulp tasks
 */
gulp.task('ci-compile', ['styles-all']);

/** 
 * ci-test gulp tasks
 */
gulp.task('ci-test', function (done) {
    runSequence('lint', 'pre-push', done);
});

/** 
 * list of release tasks
 */
gulp.task('release', function (done) {
    runSequence('release-scripts', 'umd-deploy', done);
});

/** 
 * ci-publish gulp tasks
 */
gulp.task('ci-publish', function (done) {
    var publish = common.isMasterBranch ? 'publish-production' : 'publish';
    var registry;
    if (common.isRemoteServer) {
        registry = common.isMasterBranch ? 'production-registry' : 'dev-registry';
    } else {
        registry = common.isMasterBranch ? 'local-production-registry' : 'local-dev-registry';
    }
    runSequence('release', 'publish-github', publish, registry, 'publish-ej2', 'publish-resources', 'publish-typedoc', 'publish-api', done);
});

/** 
 * ci-build-publish gulp tasks
 */
gulp.task('ci-build-publish', function () {
    if (common.isMasterBranch) {
        gulp.start('publish-production');
    } else {
        gulp.start('publish');
    }
});