'use strict';

var common = global.config = global.config || require('../utils/common.js');
var gulp = global.gulp = global.gulp || require('gulp');
var fs = global.fs = global.fs || require('fs');
var runSequence = global.runSequence = global.runSequence || require('run-sequence');
var changelogObj = require('../../src/third-party/changelog.js');


gulp.task('react-checkout', function (done) {
    common.checkout('react', 'react', done);
});


gulp.task('react-configure', function () {
    common.thridPartyConfigure('react', 'react');
});


gulp.task('react-generate', function (done) {
    var shelljs = global.shelljs = global.shelljs || require('shelljs');
    var reactSrcGen = require('../third-party/react/src-generator.js');
    var pJson = JSON.parse(fs.readFileSync('./package.json'));
    reactSrcGen(JSON.parse(fs.readFileSync('./third-party/config.json')), pJson, done);
    shelljs.cp('./third-party/readme/react.md', './third-party/react/ReadMe.md');
    if (fs.existsSync('./CHANGELOG.md')) {
        var mdContent = changelogObj.changelog('./CHANGELOG.md', './third-party/changelog/react.md');
        fs.writeFileSync('./third-party/react/CHANGELOG.md', mdContent);
    }

});


gulp.task('react-build', function (done) {
    runSequence('react-checkout', 'react-configure', 'react-generate', done);
});